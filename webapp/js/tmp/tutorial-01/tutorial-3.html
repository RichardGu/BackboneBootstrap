<!-- Step 3 - the fetch method -->

<!-- documentation reference
http://api.jquery.com/click/
http://api.jquery.com/jQuery.get/
http://underscorejs.org/#template 

// dealing with this
http://stackoverflow.com/questions/4886632/what-does-var-that-this-mean-in-javascript
http://underscorejs.org/#bind
http://api.jquery.com/jQuery.proxy/
-->

<!DOCTYPE html>
<html>
<head>
  <link href="css/bootstrap.css" rel="stylesheet">
  <script src="lib/lodash.js"></script>
  <script src="lib/jquery-1.8.1.js"></script>
</head>
<body>

<div class="container">

<h2>Javascript demo - Countries</h2>

  <form class="form-search">
    <input id="search-input" type="text" class="input-medium search-query">
    <button id="search-button" type="button" class="btn">Search</button>
  </form>

  <table id="countries-table" class="table table-striped table-bordered table-hover">
    <thead>
      <tr>
        <th>#</th>
        <th>Code</th>
        <th>Name</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

  </div>

<script type="text/javascript">
/*globals $,_*/
'use strict';

var controller = {

  // element in which to insert the rendered dom
  el: undefined,

  // template to use to generate the html to insert at this.el
  template: undefined,

  // url to fetch data from
  url: undefined,

  // filter condition to pass to the url
  filter: '',

  // data fetched from the enpoint
  data: undefined,

  // method to fetch the data from the endpoint
  // after the fetch is complete, it will call render, to update the dom
  fetch: function() {
    var url = this.url + (this.filter==='' ? '' : '?filter=' + this.filter);

    var that = this;

    $.get(url, function(data) {
      that.data = data;
      that.render();
    });

  },

  // fetches the data from url
  // uses the template to create the rendered content
  // inserts the result in this.el
  // #TODO#
  render: function() {}

};

// $(document).ready(function() {
$(function(){

  //http://bb-jugar.rhcloud.com/api/countries?filter=ar
  controller.url = 'http://bb-jugar.rhcloud.com/api/countries';
  controller.template = _.template($('#country-template').html());
  controller.el = '#countries-table tbody';

  $('#search-button').click(function() {
    controller.filter = $('#search-input').val();
    controller.fetch();
  });

})
</script>

<script type="text/template" id="country-template">
      <tr>
        <td><%= id %></td>
        <td><%= code %></td>
        <td><%= name %></td>
      </tr>
</script>

</body>
</html>
